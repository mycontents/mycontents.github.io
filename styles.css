:root{
  --bg:#0d1117;
  --panel:#161b22;
  --panel2:#0f141b;
  --border:#30363d;
  --border2:#21262d;

  --text:#c9d1d9;
  --muted:#6e7681;
  --muted2:#484f58;

  --blue:#58a6ff;
  --red:#f85149;
  --green:#238636;

  --r10:10px;
  --tap:transparent;
}

*{ box-sizing:border-box; margin:0; padding:0; }

body{
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--text);
  min-height:100vh;
  min-height:100dvh;
  padding:12px 16px 0;
}

/* Editing mode: fixed layout, no page scroll */
body.editing{
  overflow:hidden;
  position:fixed;
  inset:0;
  width:100%;
  padding:0;
}
body.editing .container{
  display:flex;
  flex-direction:column;
  height:100%;
  max-height:100%;
  padding:8px 12px 0;
  overflow:hidden;
}
body.editing header{
  flex:0 0 auto;
  position:relative;
  padding:6px 0;
  margin-bottom:8px;
}
body.editing .content-area{
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  min-height:0;
  overflow:hidden;
  border-radius:8px;
}
body.editing #editMode{
  flex:1 1 auto;
  display:flex;
  flex-direction:column;
  min-height:0;
  overflow:hidden;
}
body.editing .content-edit{
  flex:1 1 auto;
  min-height:60px;
  padding:10px 12px;
}
body.editing .edit-panel{
  flex:0 0 auto;
  padding:8px 12px;
}

body.editing .edit-hint{
  padding:6px 12px;
}

.container{ max-width:800px; margin:0 auto; position:relative; }

/* ===== Sticky header ===== */
header{
  position:sticky;
  top:0;
  z-index:100;
  background:var(--bg);
  padding:10px 0;
  border-bottom:1px solid var(--border2);
  margin-bottom:12px;
}

.header-row{
  display:flex;
  align-items:center;
  gap:10px;
}

/* Left group: section + viewed toggle (stays left) */
.header-left{
  display:flex;
  align-items:center;
  gap:10px;
  flex:0 0 auto;
}

/* Right group: all other controls (pushed to right, filter expands on desktop) */
.header-right{
  display:flex;
  align-items:center;
  justify-content:flex-end;
  gap:10px;
  flex:1 1 auto;
}

/* On desktop, filter expands to fill space */
@media (min-width: 601px) {
  .header-right{ justify-content:stretch; }
  .header-right .filter-wrap{ flex:1 1 auto; }
}

.section-btn{
  height:40px;
  min-width:170px;
  padding:0 12px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;

  background:var(--border2);
  color:var(--text);
  border:1px solid var(--border);
  border-radius:var(--r10);
  cursor:pointer;
  -webkit-tap-highlight-color:var(--tap);
  flex:0 0 auto;
}
.section-btn:hover{ border-color:var(--blue); }
.section-btn:active{ transform:translateY(.5px); }

/* section label (single line) */
.sec-label{
  display:inline-flex;
  align-items:center;
  gap:8px;
  white-space:nowrap;
}
.inline-icon{
  width:12px;
  height:12px;
  fill:currentColor;
  display:inline-block;
  flex:0 0 auto;
}

/* Viewed toggle button (3 states) */
.view-toggle{
  width:40px;
  height:40px;
  border-radius:var(--r10);
  background:transparent;
  border:1px solid transparent;
  color:var(--muted);
  cursor:pointer;
  display:grid;
  place-items:center;
  transition:color .15s, background .15s, border-color .15s;
  -webkit-tap-highlight-color:var(--tap);
  flex:0 0 auto;
}
.view-toggle:hover{ color:var(--text); background:var(--panel); border-color:var(--border); }
.view-toggle.state-show{ color:var(--text); }
.view-toggle.state-only{ color:var(--blue); background:var(--panel); border-color:var(--border); }

/* ===== Filter ===== */
.filter-wrap{
  flex:1 1 auto;
  min-width:0;
  height:40px;
  display:flex;
  align-items:center;
  gap:6px;

  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--r10);
  padding:0 8px;
}
.filter-input{
  width:100%;
  border:none;
  outline:none;
  background:transparent;
  color:var(--text);
  font-size:14px;
  min-width:0;
}
.filter-input::placeholder{ color:var(--muted); }
.filter-input:disabled{ opacity:.55; }

.filter-clear{
  width:28px;
  height:28px;
  border:none;
  border-radius:8px;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  display:grid;
  place-items:center;
  -webkit-tap-highlight-color:var(--tap);
}
.filter-clear:hover{ color:var(--text); background:var(--panel2); }
.filter-clear.hidden{ display:none; }

.filter-counter{
  font-size:12px;
  color:var(--muted2);
  white-space:nowrap;
  flex:0 0 auto;
}

/* Mobile: search button instead of full input */
.search-toggle-btn{
  display:none;
  width:40px;
  height:40px;
  border-radius:var(--r10);
  background:var(--panel);
  border:1px solid var(--border);
  color:var(--muted);
  cursor:pointer;
  place-items:center;
  -webkit-tap-highlight-color:var(--tap);
  flex:0 0 auto;
}
.search-toggle-btn:hover{ color:var(--text); border-color:var(--blue); }
.search-toggle-btn.on{ color:var(--blue); }

/* Mobile search row (in document flow) */
.mobile-search-row{
  margin-top:10px;
}
.mobile-search-row .filter-wrap{
  width:100%;
  max-width:none;
}
.mobile-search-row.hidden{
  display:none;
}

@media (max-width: 600px) {
  .section-btn{ min-width:auto; max-width:140px; }
  .filter-wrap:not(.mobile-filter){ display:none; }
  .search-toggle-btn{ display:grid; }
}

.icon-btn{
  width:40px;
  height:40px;
  border-radius:var(--r10);
  background:transparent;
  border:1px solid transparent;
  color:var(--muted);
  cursor:pointer;
  display:grid;
  place-items:center;
  transition:color .15s, background .15s, border-color .15s;
  -webkit-tap-highlight-color:var(--tap);
  flex:0 0 auto;
}
.icon-btn:hover{ color:var(--text); background:var(--panel); border-color:var(--border); }
.icon-btn:active{ transform:translateY(.5px); }
.icon-btn.error{ color:var(--red); background:var(--panel); border-color:#3d1f22; }
.icon-btn.on{ color:var(--blue); background:var(--panel); border-color:var(--border); }

.icon{ width:18px; height:18px; fill:currentColor; display:block; }
.icon.small{ width:14px; height:14px; }

/* ===== Content ===== */
.content-area{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:var(--r10);
  min-height:50px;
  overflow:hidden;
}

.content-list{
  padding:14px 15px;
  min-height:50px;
  line-height:1.5;
}

.content-list:empty::before{
  content:"—";
  color:var(--muted2);
  font-size:24px;
  display:flex;
  justify-content:center;
  padding-top:40px;
}

.item-line{
  position:relative;
  display:flex;
  align-items:center;
  gap:8px;

  padding:6px 8px;
  margin:0 -8px 8px;
  border-radius:var(--r10);

  background:transparent;
  cursor:default;
  -webkit-tap-highlight-color:var(--tap);

  user-select:text;
  -webkit-user-select:text;
}
.item-line:last-child{ margin-bottom:0; }

.item-line:hover{ background:var(--panel2); }

.item-line.selected{
  background:var(--border2);
  box-shadow:inset 0 0 0 1px var(--border);
  padding-left:44px;
}

/* Кнопка удаления позиции (слева) — остаётся на уровне наименования */
.item-del{
  position:absolute;
  left:8px;
  top:18px;
  transform:translateY(-50%);

  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  display:grid;
  place-items:center;

  opacity:0;
  pointer-events:none;
  transition:opacity .12s, background .12s, border-color .12s, color .12s;
  -webkit-tap-highlight-color:var(--tap);
}
.item-line.selected .item-del{
  opacity:1;
  pointer-events:auto;
}
.item-del:hover{
  color:var(--text);
  background:#0b0f15;
  border-color:var(--border);
}

.item-line.del-armed .item-del{
  color:var(--red);
  background:#1a0f12;
  border-color:#3d1f22;
}

.item-section-tag{
  background:var(--border);
  color:#8b949e;
  font-size:10px;
  padding:1px 6px;
  border-radius:6px;
  white-space:nowrap;
  flex-shrink:0;

  display:inline-flex;
  align-items:center;
  gap:6px;

  user-select:none;
  -webkit-user-select:none;
}

/* name + tags wrapper */
.item-main{
  flex:1;
  min-width:0;
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:8px;
}

.item-text{
  min-width:0;
  white-space:pre-wrap;
  word-break:break-word;
  cursor:text;
  user-select:text;
  -webkit-user-select:text;
}

.item-tags{
  display:inline-flex;
  flex-wrap:wrap;
  gap:6px;
}

.tag-chip{
  font-size:10px;
  line-height:1.2;
  padding:2px 7px;
  border-radius:999px;
  border:1px solid var(--border);
  background:transparent;
  color:var(--muted);
  user-select:none;
  -webkit-user-select:none;
  white-space:nowrap;
}

/* Right actions (tag + viewed) */
.right-action,
.tag-action{
  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  display:grid;
  place-items:center;
  flex:0 0 auto;
  -webkit-tap-highlight-color:var(--tap);

  opacity:0;
  pointer-events:none;
  transition:opacity .12s, background .12s, border-color .12s, color .12s;
}
.item-line.selected .right-action,
.item-line.selected .tag-action{
  opacity:1;
  pointer-events:auto;
}
.right-action:hover,
.tag-action:hover{
  color:var(--text);
  background:#0b0f15;
  border-color:var(--border);
}

/* Viewed button: always visible for viewed items */
.viewed-action{
  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid transparent;
  background:transparent;
  cursor:pointer;
  display:grid;
  place-items:center;
  flex:0 0 auto;
  -webkit-tap-highlight-color:var(--tap);
  transition:opacity .12s, background .12s, border-color .12s, color .12s;
}

/* Not viewed: hidden unless selected */
.viewed-action.not-viewed{
  color:var(--muted);
  opacity:0;
  pointer-events:none;
}
.item-line.selected .viewed-action.not-viewed{
  opacity:1;
  pointer-events:auto;
}

/* Viewed: always visible, lighter color */
.viewed-action.is-viewed{
  color:var(--text);
  opacity:0.7;
  pointer-events:auto;
}
.item-line.selected .viewed-action.is-viewed{
  opacity:1;
}

.viewed-action:hover{
  color:var(--text);
  background:#0b0f15;
  border-color:var(--border);
  opacity:1;
}

/* ===== Edit ===== */
.hidden{ display:none; }

.edit-hint{
  font-size:11px;
  color:var(--muted);
  padding:8px 15px;
  border-bottom:1px solid var(--border);
  background:var(--panel2);
}

.content-edit{
  width:100%;
  flex:1;
  min-height:0;
  border:none;
  background:var(--bg);
  color:var(--text);
  padding:14px 15px;
  font-size:14px;
  font-family:inherit;
  line-height:1.6;
  resize:none;
  overflow-y:auto;
}
.content-edit:focus{ outline:none; }

.edit-panel{
  display:flex;
  justify-content:flex-end;
  gap:10px;
  padding:10px 15px;
  border-top:1px solid var(--border);
  background:var(--panel2);
}

.edit-panel button{
  width:42px;
  height:42px;
  border:none;
  border-radius:var(--r10);
  cursor:pointer;
  display:grid;
  place-items:center;
  color:white;
  -webkit-tap-highlight-color:var(--tap);
}
.btn-cancel{ background:var(--border); }
.btn-save{ background:var(--green); }

/* TMDB mode button in edit panel */
.btn-tmdb-mode{
  width:42px;
  height:42px;
  border:none;
  border-radius:var(--r10);
  cursor:pointer;
  display:grid;
  place-items:center;
  background:var(--border);
  color:var(--muted);
  margin-right:auto;
  -webkit-tap-highlight-color:var(--tap);
  transition:color .15s, background .15s;
}
.btn-tmdb-mode.mode-off{
  color:var(--muted2);
  opacity:0.5;
}
.btn-tmdb-mode.mode-new{
  color:var(--text);
  background:var(--border);
}
.btn-tmdb-mode.mode-all{
  color:white;
  background:var(--blue);
}



/* ===== Dropdowns ===== */
.dropdown-menu{
  position:absolute;
  background:var(--panel);
  border:1px solid var(--blue);
  border-radius:var(--r10);
  z-index:120;
  overflow:hidden;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}

.dropdown-menu.section-menu{ padding:8px 0; min-width:260px; }
.dropdown-menu.sort-menu{ padding:6px 0; width:170px; min-width:170px; }
.dropdown-menu.tag-filter-menu{ padding:10px; width:240px; min-width:240px; }
.dropdown-menu.tag-editor-menu{ padding:10px; width:280px; min-width:280px; }

.menu-option{
  padding:8px 14px;
  cursor:pointer;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:10px;
  user-select:none;
  -webkit-tap-highlight-color:var(--tap);
}
.menu-option:hover{ background:var(--border2); }
.menu-option.active{ color:var(--blue); }

/* All sections row with + button */
.menu-option.all-sections-row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid var(--border);
  margin-bottom:6px;
  padding-bottom:10px;
}
.menu-option.all-sections-row > span{
  cursor:pointer;
  flex:1;
}
.menu-option.all-sections-row > span:hover{
  color:var(--blue);
}

.add-section-btn{
  width:28px;
  height:28px;
  border-radius:8px;
  border:none;
  background:transparent;
  color:var(--text);
  font-size:20px;
  font-weight:bold;
  cursor:pointer;
  display:grid;
  place-items:center;
  -webkit-tap-highlight-color:var(--tap);
  transition:background .12s, color .12s;
}
.add-section-btn:hover{
  background:var(--border2);
  color:var(--blue);
}

.menu-divider{ border-top:1px solid var(--border); margin:6px 0; }

.menu-actions{
  margin-left:auto;
  display:flex;
  align-items:center;
}

.mini-btn{
  width:26px;
  height:26px;
  border-radius:8px;
  display:grid;
  place-items:center;
  background:transparent;
  border:1px solid transparent;
  color:var(--muted);
  cursor:pointer;
  -webkit-tap-highlight-color:var(--tap);
  transition:color .12s, background .12s, border-color .12s;
}
.mini-btn:hover{ background:var(--panel2); color:var(--text); border-color:var(--border); }
.mini-btn.danger:hover{ color:var(--red); border-color:#3d1f22; }

.menu-option.armed .mini-btn.danger{
  color:var(--red);
  background:#1a0f12;
  border-color:#3d1f22;
}

.new-section-input{
  width:calc(100% - 28px);
  margin:0 14px 8px;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:var(--r10);
  color:var(--text);
  padding:8px 10px;
  font-size:13px;
}
.new-section-input:focus{ outline:none; border-color:var(--blue); }

.sort-dir{ margin-left:auto; color:#8b949e; font-size:12px; }

/* Settings panel inside section menu */
.settings-panel{
  padding:10px 14px;
}
.settings-panel.hidden{
  display:none;
}
.settings-panel label{
  display:block;
  font-size:11px;
  color:#8b949e;
  margin-bottom:4px;
}
.settings-panel input{
  width:100%;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:var(--r10);
  color:var(--text);
  padding:8px 10px;
  font-size:13px;
  margin-bottom:12px;
}
.settings-panel input:focus{ outline:none; border-color:var(--blue); }

.settings-buttons{ display:flex; gap:8px; }
.settings-btn{
  flex:1;
  height:42px;
  border:none;
  border-radius:var(--r10);
  cursor:pointer;
  display:grid;
  place-items:center;
  color:white;
  -webkit-tap-highlight-color:var(--tap);
}
.btn-primary{ background:var(--green); }
.btn-share{ background:#1f6feb; }

.setup-prompt{ padding:16px; color:#8b949e; text-align:center; }

/* ===== Tag menus ===== */
.tag-menu-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:10px;
}
.tag-menu-title{
  flex:1;
  font-size:11px;
  color:#8b949e;
  text-transform:uppercase;
  letter-spacing:.08em;
}

/* TMDB button */
.tmdb-btn{
  transition:color .15s, background .15s, border-color .15s;
}
.tmdb-btn:hover{ color:var(--blue); }
.tmdb-btn.loading{
  opacity:.5;
  pointer-events:none;
}
.tmdb-btn.success{ color:var(--green); }
.tmdb-btn.error{ color:var(--red); }
.tag-menu-list{
  display:flex;
  flex-direction:column;
  gap:6px;
  max-height:260px;
  overflow:auto;
  padding-right:2px;
}
.tag-menu-hint{
  margin-top:10px;
  color:var(--muted2);
  font-size:11px;
}

.tag-option{
  display:flex;
  align-items:center;
  gap:10px;
  padding:8px 10px;
  border-radius:10px;
  cursor:pointer;
  user-select:none;
  -webkit-tap-highlight-color:var(--tap);
}
.tag-option:hover{ background:var(--border2); }

.tag-check{
  width:16px;
  height:16px;
  border-radius:4px;
  border:1px solid var(--border);
  display:grid;
  place-items:center;
  color:transparent;
  flex:0 0 auto;
}
.tag-option.on .tag-check{
  border-color:rgba(88,166,255,.6);
  background:rgba(88,166,255,.12);
  color:var(--blue);
}

.tag-name{
  font-size:13px;
  color:var(--text);
}
.tag-count{
  margin-left:auto;
  font-size:12px;
  color:var(--muted2);
}

.tag-add-row{
  display:flex;
  align-items:center;
  gap:8px;
  margin-bottom:10px;
}
.tag-add-input{
  flex:1;
  min-width:0;
  background:var(--bg);
  border:1px solid var(--border);
  border-radius:var(--r10);
  color:var(--text);
  padding:8px 10px;
  font-size:13px;
}
.tag-add-input:focus{ outline:none; border-color:var(--blue); }

.tag-pill{
  display:flex;
  align-items:center;
  gap:8px;

  border:1px solid var(--border);
  background:var(--panel2);
  border-radius:999px;
  padding:4px 6px 4px 12px;
}
.tag-pill-text{
  flex:1;
  min-width:0;
  font-size:13px;
  color:var(--text);
  background:transparent;
  border:none;
  outline:none;
  padding:0;
}
.tag-pill-text:focus{
  color:var(--blue);
}

.tag-empty{
  padding:10px;
  color:var(--muted2);
  font-size:13px;
}

/* Info/description button on item — only for selected with desc */
.desc-action{
  display:none;
}
.item-line.selected .desc-action.has-desc{
  display:grid;
  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  place-items:center;
  flex:0 0 auto;
  -webkit-tap-highlight-color:var(--tap);
  transition:background .12s, border-color .12s, color .12s;
}
.item-line.selected .desc-action.has-desc:hover{
  color:var(--text);
  background:#0b0f15;
  border-color:var(--border);
}

/* Description button highlighted when expanded — same style as tag button hover */
.item-line.selected .desc-action.has-desc.open{
  color:var(--text);
  background:#0b0f15;
  border-color:var(--border);
}

/* Inline description expanded under item */
.item-line.expanded{
  flex-wrap:wrap;
}
.item-desc-block{
  position:relative;
  width:100%;
  margin-top:12px;
  padding:12px 0 8px;
  border-top:1px solid var(--border);
  display:flex;
  gap:14px;
  align-items:flex-start;
}

.item-desc-poster{
  width:120px;
  min-width:120px;
  border-radius:8px;
  display:block;
  flex:0 0 auto;
}

.item-desc-content{
  flex:1;
  min-width:0;
}

.item-desc-text{
  font-size:14px;
  line-height:1.55;
  color:var(--text);
  margin-bottom:10px;
}

/* Description delete button — bottom right corner */
.desc-del-btn{
  position:absolute;
  right:8px;
  bottom:8px;
  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid transparent;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  display:grid;
  place-items:center;
  -webkit-tap-highlight-color:var(--tap);
  transition:color .12s, background .12s, border-color .12s;
}
.desc-del-btn:hover{
  color:var(--red);
  background:#1a0f12;
  border-color:#3d1f22;
}

/* Mobile: poster on top */
@media (max-width: 480px) {
  .item-desc-block{
    flex-direction:column;
    gap:12px;
  }
  .item-desc-poster{
    width:100%;
    max-width:200px;
    min-width:auto;
  }
}

/* ===== Undo bar ===== */
.undo-bar{
  position:fixed;
  left:50%;
  bottom:14px;
  transform:translateX(-50%);
  z-index:200;

  display:flex;
  align-items:center;
  gap:10px;

  background:#0b0f15;
  border:1px solid var(--border);
  box-shadow:0 10px 25px rgba(0,0,0,.35);
  border-radius:999px;
  padding:8px 10px 8px 12px;
  max-width:min(92vw, 560px);
}
.undo-text{
  color:#8b949e;
  font-size:13px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  max-width: 420px;
}
.undo-btn{
  width:34px;
  height:34px;
  border-radius:999px;
  border:1px solid var(--border);
  background:var(--panel);
  color:var(--text);
  cursor:pointer;
  display:grid;
  place-items:center;
  -webkit-tap-highlight-color:var(--tap);
}
.undo-btn:hover{ border-color:var(--blue); }
.undo-bar.hidden{ display:none; }

/* ===== Progress bar ===== */
.progress-bar{
  position:fixed;
  left:0;
  right:0;
  bottom:0;
  height:32px;
  background:var(--panel);
  border-top:1px solid var(--border);
  z-index:250;
  display:flex;
  align-items:center;
}
.progress-bar.hidden{ display:none; }

.progress-fill{
  position:absolute;
  left:0;
  top:0;
  bottom:0;
  background:var(--blue);
  opacity:0.2;
  width:0%;
  transition:width 0.3s ease-out;
}

.progress-text{
  position:relative;
  z-index:1;
  width:100%;
  text-align:center;
  font-size:12px;
  color:var(--muted);
}
